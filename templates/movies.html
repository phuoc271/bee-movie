{% extends "header.html" %}

{% block title %}Chi Tiết Phim - {{ movie.title }}{% endblock %}

{% block content %}
<main>
    <div class="container">
        
        <nav class="breadcrumb">
            <a href="{{ url_for('home') }}">Trang chủ</a> &raquo; 
            <a href="{{ url_for('now_playing') }}">Phim</a> &raquo; 
            {{ movie.title }}
        </nav>

        <h1>{{ movie.title }}</h1>

        <div class="movie-info">
            <div class="poster" id="movie-poster">
                {% if movie.poster_url %}
                <img src="{{ movie.poster_url }}" alt="Poster phim {{ movie.title }}">
                {% else %}
                <img src="https://via.placeholder.com/300x450/333333/FFFFFF?text=No+Poster" alt="Poster phim {{ movie.title }}">
                {% endif %}

                {% if movie.trailer_url %}
                <button class="play-button" onclick="openTrailerModal('{{ movie.trailer_url }}')">
                    ▶
                </button>
                {% endif %}
                </div>
            
            <div class="details">
                <p>
                    <strong>Điểm đánh giá:</strong> 
                    {{ movie.vote_average | default(0) | round(1) }} / 10 
                    ({{ movie.vote_count | default(0) }} lượt)
                </p>
                <p><strong>Thời lượng :</strong> {{ movie.runtime }} phút</p>
                <p><strong>Thể loại :</strong> 
                    {% if movie.genres %}
                        {{ movie.genres | join(', ') }}
                    {% else %}
                        Đang cập nhật
                    {% endif %}
                </p>
                <p><strong>Khởi chiếu :</strong> {{ movie.release_date }}</p>
                <p><strong>Đạo diễn :</strong> 
                    {% if movie.director %}
                        {{ movie.director }}
                    {% else %}
                        Đang cập nhật
                    {% endif %}
                </p>
                <p><strong>Diễn viên :</strong> 
                {% if movie.cast and movie.cast|length > 0 %}
                    {{ movie.cast | join(', ') }}
                {% else %}
                    Đang cập nhật
                {% endif %}
            </p>

                <p><strong>Quốc gia :</strong> {{ movie.original_language }}</p>
                <p class="mt-4"><strong>Tóm tắt :</strong> 
                    {% if movie.overview %}
                        {{ movie.overview }}
                    {% else %}
                        Đang cập nhật
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="section">
            <h2>Lịch chiếu hôm nay tại MEGA GS</h2>
            <div class="showtimes-list" id="showtimesList">
                {% if showtimes %}
                    {% for showtime in showtimes %}
                        <a href="{{ url_for('booking', showtime_id=showtime.id) }}" class="showtime">
                            {{ showtime.time }}
                        </a>
                    {% endfor %}
                {% else %}
                    <p style="color: #ccc;">Hiện chưa có suất chiếu được mở bán.</p>
                {% endif %}
            </div>
        </div>
    </div>
</main>

<div id="trailerModal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closeTrailerModal()">&times;</span>
        <iframe 
            id="trailer-iframe" 
            width="100%" 
            height="400" 
            src="" 
            frameborder="0" 
            allow="autoplay; encrypted-media" 
            allowfullscreen>
        </iframe>
    </div>
</div>
<script>
    function openTrailerModal(trailerUrl) {
        const modal = document.getElementById('trailerModal');
        const iframe = document.getElementById('trailer-iframe');
        
        iframe.src = trailerUrl; 
        
        modal.style.display = "block";
        
        document.body.style.overflow = 'hidden'; 
    }

    function closeTrailerModal() {
        const modal = document.getElementById('trailerModal');
        const iframe = document.getElementById('trailer-iframe');
        
        iframe.src = ""; 
        
        modal.style.display = "none";
        
        document.body.style.overflow = 'auto'; 
    }

    window.onclick = function(event) {
        const modal = document.getElementById('trailerModal');
        if (event.target === modal) {
            closeTrailerModal();
        }
    }
</script>
{% endblock %}

{% block custom_js %}

{% endblock %}