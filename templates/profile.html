<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Hồ sơ cá nhân | BeeComic</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

{% include "header.html" %}

<div class="profile-header-container">
    <div class="profile-banner-bg" 
         style="background-image: url('{{ url_for('static', filename=user.avatar) if user.avatar else url_for('static', filename='app/images/top-logo.png') }}');">
    </div>
    
    <div class="avatar-container">
        <label for="avatarInput" style="cursor: pointer;">
            <div class="avatar-hover-wrapper">
                <img id="avatarPreview" 
                     src="{{ url_for('static', filename=user.avatar) if user.avatar else url_for('static', filename='app/images/top-logo.png') }}" 
                     class="avatar-img">
                
                <div class="avatar-text-overlay">
                    <i class="fa fa-camera"></i>
                    <span>Đổi ảnh</span>
                </div>
            </div>
        </label>
    </div>
</div>

<div class="container content-section" style="margin-top: 100px;">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <form method="POST" action="{{ url_for('update_profile') }}" enctype="multipart/form-data">
                <input type="file" name="avatar" id="avatarInput" accept="image/*" onchange="previewImage(this)" style="display: none;">

                <div class="mb-4">
                    <label class="form-label-custom">Họ và tên</label>
                    <input type="text" name="fullname" class="form-control form-control-custom" value="{{ user.fullname or '' }}">
                </div>

                <div class="mb-4 text-center">
                    <label class="form-label-custom d-block mb-3">Giới tính</label>
                    <div class="d-flex justify-content-center gender-group">
                        <label>
                            <input type="radio" name="gender" value="M" {% if user.gender == 'M' %}checked{% endif %}>
                            <span class="gender-text"><i class="fas fa-mars" style="color: #0099ff;"></i> Nam</span>
                        </label>
                        <label>
                            <input type="radio" name="gender" value="F" {% if user.gender == 'F' %}checked{% endif %}>
                            <span class="gender-text"><i class="fas fa-venus" style="color: #FF66CC;"></i> Nữ</span>
                        </label>
                        <label>
                            <input type="radio" name="gender" value="O" {% if user.gender == 'O' %}checked{% endif %}>
                            <span class="gender-text">Không hiện</span>
                        </label>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label-custom">Email</label>
                    <input type="email" class="form-control form-control-custom" style="opacity: 0.5; cursor: not-allowed;" value="{{ user.email }}" readonly>
                </div>

                <div class="mb-4">
                    <label class="form-label-custom">Tên đăng nhập</label>
                    <input type="text" name="username" class="form-control form-control-custom" value="{{ user.username }}">
                </div>

                <button type="submit" class="btn btn-secondary w-100">CẬP NHẬT HỒ SƠ</button>
            </form>

            <form action="{{ url_for('delete_account') }}" method="POST" onsubmit="return confirm('Bạn có chắc chắn muốn xóa tài khoản?')">
                <button type="submit" class="btn btn-delete w-100 mt-3">XÓA TÀI KHOẢN</button>
            </form>
        </div>
    </div>
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
                
                var banner = document.querySelector('.profile-banner-bg');
                if (banner) {
                    banner.style.backgroundImage = "url('" + e.target.result + "')";
                }
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

</body>
</html>